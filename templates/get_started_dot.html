{% extends "layout.html" %}
{% block content %}
<div class="container text-center mt-5">
    <h2>Letâ€™s first learn about how to enter dots and dashes on this website!</h2>
    <p>Morse code consists of a set of standardized sequences of short and long signals, typically referred to as dots and dashes</p>
    <h4>Press space for less than 0.2 to enter a dot</h4>
    <div id="duration-display">0 seconds</div>
    <div class="input-morse-code"></div>
    <div class="flashlight-container">
        <img class="flashlight" src="/static/image/led off.png" alt="led light off">
    </div>
    <div id="answer-feedback-container"></div>
</div>

<script>
    let spaceDownTime = 0;
    let spaceDown = false;
    let duration = 0;
    let morseAudio = new Audio('/static/audio/morse_code_T.mp3');
    let submitted = false;
    let isCorrect = false;

    $(document).keydown(function(e) {
        if (e.which === 32 && !spaceDown && !submitted) { // Check if the pressed key is the space key
            spaceDownTime = Date.now();
            displayDuration();
            $('#duration-display').text('0 seconds');
            spaceDown = true;
            playAudio();

            // turn on flashlight
            $('.flashlight-container').empty();
            $('.flashlight-container').append('<img class="flashlight" src="/static/image/led on.png">')
          } else if (e.which === 8 && !submitted) { // Check if the pressed key is the backspace key
            // Remove the last character from input-morse-code
            let text = $('.input-morse-code').text();
            $('.input-morse-code').text(text.slice(0, -1));
        }
    });

    $(document).keyup(function(e) {
        if (e.which === 32 && spaceDown) {
            spaceDown = false;
            clearInterval(audioTimer);
            morseAudio.pause();
            spaceDownTime = 0;

            // turn off flashlight
            $('.flashlight-container').empty();
            $('.flashlight-container').append('<img class="flashlight" src="/static/image/led off.png">')
          }
    });

    function displayDuration() {
        let isError = false;
        intervalId = setInterval(function() {
            if (spaceDown) {
              duration = Date.now() - spaceDownTime;
              $('#duration-display').text(duration/1000 + ' seconds');
            } else {
                $('.error').remove();
                if (duration < 200) {
                    $('.input-morse-code').append('.');
                    let feedback = $("<div class='feedback'>").html("Great!").addClass("quiz-correct");
                    let continueMessage = $("<div class='continue-message'>").html("Click anywhere to continue");
                    $('#answer-feedback-container').append(feedback, continueMessage);
                    submitted = true;
                    isCorrect = true;
                } else {
                    let error = $("<div class='error'>")
                    error.html("try to enter the dot again!")
                    if (!isError) {
                        isError = true;
                        $('.input-morse-code').after(error);
                    }
                }
                clearInterval(intervalId); 
            }
          }, 10);
    }

    function playAudio() {
        morseAudio.currentTime = 0; // Reset audio to the beginning
        morseAudio.play();
        // Set a timeout to stop audio playback after 500 milliseconds
        audioTimer = setTimeout(function() {
            morseAudio.pause();
        }, 500);
    }

    $(document).click(function() {
        if (submitted && isCorrect) {
            window.location.href = '/get-started-dash';
        }
    });
</script>
{% endblock %}
